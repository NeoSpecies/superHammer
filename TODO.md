# 待办事项清单

#### 特性一：框架内边缘AI
- **功能概述**：在框架内集成边缘AI（最大不超过4B的模型），主要用于格式化文件处理等工作。
- **数据存储**：将提示词以JSON格式存储起来。
- **使用方式**：通过指定的输入输出标准本地通讯方式来使用该功能。

#### 特性二：AIOT的AI通讯协议
- **功能概述**：开发专门的AIOT的AI通讯协议，用于AI控制硬件、读取硬件数据以及实现硬件之间的联动。
- [ ] 完成协议基础框架设计（消息格式、指令类型、错误码定义）
- [ ] 实现Golang层协议解析与硬件指令转发逻辑

#### 特性三：增加其他通讯协议 - MCP
- **功能概述**：在框架里全面集成并兼容MCP通讯协议...
- [ ] 实现MCP角色区分架构
  - [x] 定义角色类型（Host/Client/Server）
  - [ ] 实现注册中心管理三类节点元数据
  - [ ] 开发角色声明头解析机制（ROLE=HOST|CLIENT|SERVER）
  - [ ] 实现基于角色的连接路由管道
- [ ] 开发MCP角色专属SDK
  - [ ] Host节点服务发现接口
  - [ ] Server节点服务注册接口
  - [ ] Client请求代理工具类
- [ ] 完善MCP配置体系
  - [ ] 添加host_port/client_port/server_port配置项
  - [ ] 实现服务发现间隔参数（discovery_interval）
- **开发优势**：借助这种抽象，开发者开发各类MCP相关插件时，能直接通过函数进行无感调用，无需做复杂的通讯配置，进而大幅提升开发效率、降低开发难度。
- [ ] 实现MCP协议元数据驱动路由机制（基于端口/消息头动态路由至对应插件）
- [ ] 开发MCP协议解析插件（支持基础帧解析：长度/分隔符识别）
- [ ] 提供MCP插件开发SDK（包含协议编解码工具类、事件回调接口）

### 非通讯层应用调用Go各类通讯协议的方法
#### 1. 封装通讯协议接口
- [ ] 在Go中为HTTP、TCP、MCP等协议定义统一接口`ProtocolHandler`（包含`Listen`/`Send`/`Close`方法）
- [ ] 实现接口具体适配器（如`HTTPAdapter`、`TCPAdapter`）

## 核心通信层优化（Golang）
- [ ] 实现多协议监听器：
  - [ ] HTTP/HTTPS Server（支持RESTful API、文件服务）
  - [ ] WebSocket Server（实时双向通信）
  - [ ] TCP/UDP Server（原始连接处理）
  - [ ] MQTT Broker/客户端桥接（支持QoS、保留消息、LWT）
- [ ] 实现IPC消息分帧机制：在Golang端添加"长度头+负载"的消息解析逻辑（参考`internal/ipc/socket/socket_receive.go`的`HandleSocket`函数），解决粘包/拆包问题
- [ ] 完善心跳与重连机制：Golang核心增加对应用服务心跳包的响应逻辑；PHP/其他语言SDK实现自动重连功能（示例参考`copy/test.php`的心跳发送逻辑）
- [ ] 增强序列化兼容性：在IPC请求/响应结构体中添加`version`字段（如`internal/ipc/socket/socket_receive.go`的`Request`类型），支持协议版本管理
- [ ] 实现统一日志与监控：提供日志接口（支持级别过滤）和Prometheus指标（连接数/吞吐量/错误率）
- [ ] 开发插件扩展机制：允许通过Go plugin实现自定义认证、限流等功能

## 多语言扩展
- [ ] 开发Python/Java IPC客户端SDK：封装与Golang核心通信的Socket连接、消息序列化、事件回调等基础功能
- [ ] 支持MCP自定义协议：在Golang层设计可配置的协议解析插件（如通过元数据驱动路由），并在多语言SDK中提供协议编解码工具类
- [ ] 提供多语言事件订阅接口：支持应用层监听连接/断开/数据包事件（如Python的`on_connect`回调）

## 平台级功能（IoT平台方向）
- [ ] 设备管理模块：实现设备认证（TLS双向认证）、设备影子（状态同步）功能（应用层实现）
- [ ] 数据持久化接口：定义统一数据存储抽象（如`DataStore`接口，支持MySQL/Redis实现）
- [ ] 规则引擎集成：在应用层实现基于设备数据的规则触发逻辑（如Python的`RuleEngine`类）
- [ ] API网关功能扩展：在Golang层实现认证/限流中间件，或委托应用层处理请求转换

## 稳定性与可观测性
- [ ] 完善Golang核心错误处理：为每个goroutine添加`recover`机制，使用`context`管理生命周期防止泄漏
- [ ] 实现IPC背压处理：Golang核心添加有界队列（如1000条），超过阈值时丢弃或通知应用层
- [ ] 集成服务发现：对接Consul/etcd，实现应用服务实例动态感知与负载均衡
- [ ] 接入OpenTelemetry：在IPC通信中注入追踪上下文，关联网络事件与业务处理链路
- [ ] 编写测试用例：覆盖多协议通信（单元测试）、IPC可靠性（集成测试）、高并发场景（压力测试）

## 文档与工具链
- [ ] 编写架构设计文档：包含各模块职责、通信流程、扩展规范
- [ ] 提供多语言示例代码：如Python的"处理WebSocket消息"、Java的"调用MCP插件"示例

